<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>📦 Cuddeys Deal Finder</title>
  <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; margin: 6px 0; width: 100%; max-width: 400px; }
    #map, #streetview { width: 100%; height: 400px; margin-bottom: 20px; }
    h2, h3 { margin-top: 24px; }
    ul { list-style: none; padding-left: 0; }
    li { margin-bottom: 6px; }
    pre { background: #f4f4f4; padding: 10px; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>📦 Cuddeys Deal Finder</h1>

  <form method="post">
    <input
      type="text"
      name="query"
      placeholder="Property Address (optional)"
      value="{{ request.form.query or '' }}"
    >
    <input
      type="text"
      name="facility"
      placeholder="Facility Name (optional)"
      value="{{ request.form.facility or '' }}"
    >
    <button type="submit">Search</button>
  </form>

  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}

  {% if data.address %}
    <p>📍 Location: {{ data.address }}</p>
    <p>🏛 County: {{ data.county }}</p>

    <div id="map"></div>
    <div id="streetview"></div>
    <script>
      var center = { lat: {{ data.lat }}, lng: {{ data.lng }} };
      var map = new google.maps.Map(
        document.getElementById('map'),
        { center: center, zoom: 14 }
      );
      new google.maps.StreetViewPanorama(
        document.getElementById('streetview'),
        { position: center, pov: { heading: 165, pitch: 0 }, zoom: 1 }
      );
    </script>

    <h2>🏢 Google Business Profile</h2>
    {% if data.place %}
      <p><strong>Name:</strong> {{ data.place.name }}</p>
      <p><strong>Phone:</strong> {{ data.place.formatted_phone_number or 'N/A' }}</p>
      <p><strong>Website:</strong>
        {% if data.place.website %}
          <a href="{{ data.place.website }}" target="_blank">{{ data.place.website }}</a>
        {% else %}
          N/A
        {% endif %}
      </p>
      <p><strong>Rating:</strong> {{ data.place.rating or 'N/A' }} ⭐ ({{ data.place.user_ratings_total or 0 }} reviews)</p>
      {% if data.place.opening_hours %}
        <p><strong>Hours:</strong></p>
        <ul>
          {% for line in data.place.opening_hours.weekday_text %}
            <li>{{ line }}</li>
          {% endfor %}
        </ul>
      {% endif %}
      {% if data.place.reviews %}
        <h3>📝 Recent Reviews</h3>
        <ul>
          {% for r in data.place.reviews %}
            <li>"{{ r.text }}" – {{ r.author_name }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% else %}
      <p>No business profile found</p>
    {% endif %}

    <h2>📋 CAD Records</h2>
    <p><strong>Owner:</strong> {{ data.cad.owner_name }}</p>
    <p><strong>Tax ID:</strong> {{ data.cad.tax_id }}</p>
    <p><strong>Mailing Address:</strong> {{ data.cad.mailing_address }}</p>

    <h2>🗂 LLC Information</h2>
    <p><strong>Name:</strong> {{ data.llc.llc_name or 'N/A' }}</p>
    <p><strong>Formation Date:</strong> {{ data.llc.formation_date or 'N/A' }}</p>
    <p>
      <strong>OpenCorporates:</strong>
      {% if data.llc.opencorporates_url %}
        <a href="{{ data.llc.opencorporates_url }}" target="_blank">Link</a>
      {% else %}
        N/A
      {% endif %}
    </p>
    <p>
      <strong>SOS:</strong>
      {% if data.llc.sos_url %}
        <a href="{{ data.llc.sos_url }}" target="_blank">Link</a>
      {% else %}
        N/A
      {% endif %}
    </p>

    <h2>👤 Owner Profile</h2>
    <pre>{{ data.owner }}</pre>

    <h2>💰 Deal Metrics</h2>
    <p>Cap Rate: {{ data.cap }}%</p>
    <p>Price per SF: ${{ data.ppsf }}</p>
    <p>Score: {{ data.score }}</p>

    <h2>📊 Market Competition</h2>
    <h3>Within 5 mile radius ({{ data.market.competitors_5|length }} found)</h3>
    <ul>
      {% for c in data.market.competitors_5 %}
        <li>{{ c.name }} – {{ c.rating or 'N/A' }} ⭐, {{ c.reviews or 0 }} reviews ({{ c.vicinity }})</li>
      {% endfor %}
      {% if not data.market.competitors_5 %}
        <li>No competitors found within 5 miles</li>
      {% endif %}
    </ul>

    <h3>Within 10 mile radius ({{ data.market.competitors_10|length }} found)</h3>
    <ul>
      {% for c in data.market.competitors_10 %}
        <li>{{ c.name }} – {{ c.rating or 'N/A' }} ⭐, {{ c.reviews or 0 }} reviews ({{ c.vicinity }})</li>
      {% endfor %}
      {% if not data.market.competitors_10 %}
        <li>No competitors found within 10 miles</li>
      {% endif %}
    </ul>
  {% endif %}
</body>
</html>
